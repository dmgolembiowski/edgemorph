ModuleDeclaration(name=ObjectRef(name='api'),declarations=[CreateObjectType(name=ObjectRef(name='Session'),commands=[CreateConcreteLink(is_required=True,target=TypeName(maintype=ObjectRef(name='User')),cardinality=<SchemaCardinality.One:'One'>,name=ObjectRef(name='user')),CreateConcreteProperty(is_required=True,target=TypeName(maintype=ObjectRef(name='duration',module='std')),cardinality=<SchemaCardinality.One:'One'>,name=ObjectRef(name='allottedDuration'),commands=[SetField(name='default',value=SelectQuery(aliases=[ModuleAliasDecl(module='api')],result=TypeCast(expr=StringConstant(value='24hours'),type=TypeName(maintype=ObjectRef(name='duration'))),orderby=[]))]),CreateConcreteProperty(is_required=True,target=TypeName(maintype=ObjectRef(name='datetime',module='std')),cardinality=<SchemaCardinality.One:'One'>,name=ObjectRef(name='createdAt'),commands=[SetField(name='default',value=SelectQuery(aliases=[ModuleAliasDecl(module='api')],result=FunctionCall(func='datetime_current'),orderby=[]))]),CreateConcreteProperty(is_required=True,target=TypeName(maintype=ObjectRef(name='str',module='std')),cardinality=<SchemaCardinality.One:'One'>,name=ObjectRef(name='sessionID')),CreateConcreteProperty(target=TypeName(maintype=ObjectRef(name='str',module='std')),cardinality=<SchemaCardinality.One:'One'>,name=ObjectRef(name='token'))]),CreateFunction(returning=TypeName(maintype=ObjectRef(name='Session')),code=FunctionCode(language=<Language.EdgeQL:'EDGEQL'>,from_expr=False),nativecode=DeleteQuery(aliases=[ModuleAliasDecl(module='api')],subject=IfElse(condition=BinOp(left=BinOp(left=TypeCast(expr=Path(steps=[ObjectRef(name='Session'),Ptr(ptr=ObjectRef(name='createdAt'),direction=<PointerDirection.Outbound:'>'>)]),type=TypeName(maintype=ObjectRef(name='datetime'))),op='+',right=TypeCast(expr=Path(steps=[ObjectRef(name='Session'),Ptr(ptr=ObjectRef(name='allottedDuration'),direction=<PointerDirection.Outbound:'>'>)]),type=TypeName(maintype=ObjectRef(name='duration')))),op='<=',right=FunctionCall(func='datetime_current')),if_expr=Path(steps=[ObjectRef(name='Session')]),else_expr=TypeCast(expr=Set(),type=TypeName(maintype=ObjectRef(name='Session')))),orderby=[]),returning_typemod=<TypeModifier.SetOfType:'SetOfType'>,name=ObjectRef(name='clear_expired')),CreateFunction(returning=TypeName(maintype=ObjectRef(name='Session')),code=FunctionCode(language=<Language.EdgeQL:'EDGEQL'>,from_expr=False),nativecode=ForQuery(iterator=Set(elements=[FunctionCall(func='validate_credentials',args=[Path(steps=[ObjectRef(name='EMAIL')]),Path(steps=[ObjectRef(name='PASS')])])]),iterator_alias='USER',aliases=[ModuleAliasDecl(module='api')],result=InsertQuery(subject=Path(steps=[ObjectRef(name='Session')]),shape=[ShapeElement(expr=Path(steps=[Ptr(ptr=ObjectRef(name='token'),direction=<PointerDirection.Outbound:'>'>)]),compexpr=TypeCast(expr=SelectQuery(result=FunctionCall(func='random_big_str_id'),orderby=[]),type=TypeName(maintype=ObjectRef(name='str'))),operation=ShapeOperation(op=<ShapeOp.ASSIGN:'ASSIGN'>)),ShapeElement(expr=Path(steps=[Ptr(ptr=ObjectRef(name='sessionID'),direction=<PointerDirection.Outbound:'>'>)]),compexpr=TypeCast(expr=SelectQuery(result=FunctionCall(func='random_big_str_id'),orderby=[]),type=TypeName(maintype=ObjectRef(name='str'))),operation=ShapeOperation(op=<ShapeOp.ASSIGN:'ASSIGN'>)),ShapeElement(expr=Path(steps=[Ptr(ptr=ObjectRef(name='user'),direction=<PointerDirection.Outbound:'>'>)]),compexpr=Path(steps=[ObjectRef(name='USER')]),operation=ShapeOperation(op=<ShapeOp.ASSIGN:'ASSIGN'>))])),returning_typemod=<TypeModifier.SetOfType:'SetOfType'>,params=[FuncParam(name='EMAIL',type=TypeName(maintype=ObjectRef(name='str',module='std')),kind=<ParameterKind.PositionalParam:'PositionalParam'>),FuncParam(name='PASS',type=TypeName(maintype=ObjectRef(name='str',module='std')),kind=<ParameterKind.PositionalParam:'PositionalParam'>)],name=ObjectRef(name='create_new_session')),CreateFunction(returning=TypeName(maintype=ObjectRef(name='User')),code=FunctionCode(language=<Language.EdgeQL:'EDGEQL'>,from_expr=False),nativecode=SelectQuery(aliases=[ModuleAliasDecl(module='api')],result=SelectQuery(result=Path(steps=[ObjectRef(name='User')]),implicit=True,orderby=[],where=BinOp(left=BinOp(left=Path(steps=[Ptr(ptr=ObjectRef(name='email'),direction=<PointerDirection.Outbound:'>'>)],partial=True),op='=',right=Path(steps=[ObjectRef(name='EMAIL')])),op='AND',right=BinOp(left=Path(steps=[Ptr(ptr=ObjectRef(name='password'),direction=<PointerDirection.Outbound:'>'>)],partial=True),op='=',right=Path(steps=[ObjectRef(name='PASS')])))),limit=IntegerConstant(value='1')),returning_typemod=<TypeModifier.SetOfType:'SetOfType'>,params=[FuncParam(name='EMAIL',type=TypeName(maintype=ObjectRef(name='str',module='std')),kind=<ParameterKind.PositionalParam:'PositionalParam'>),FuncParam(name='PASS',type=TypeName(maintype=ObjectRef(name='str',module='std')),kind=<ParameterKind.PositionalParam:'PositionalParam'>)],name=ObjectRef(name='validate_credentials'))])
